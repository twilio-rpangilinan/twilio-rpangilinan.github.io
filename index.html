
<!DOCTYPE html> 
<html> 
<head> 
    <!-- Optimizely Web snippet -->
    <!--script src="https://unpkg.com/@optimizely/optimizely-sdk/dist/optimizely.browser.umd.min.js"></script>
    
    <!-- Begin Monetate ExpressTag Sync v8.1. Place at start of document head. DO NOT ALTER. 
<script type="text/javascript">var monetateT = new Date().getTime();</script>
<script type="text/javascript" src="//se.monetate.net/js/2/a-63d5abf3/p/stage.segment.io/entry.js"></script>
 End Monetate tag. -->
    <title>Test Website</title> 
    <!-- Optimizely -->
    <script src="scripts/require.js"></script>
    <script src="https://unpkg.com/@optimizely/optimizely-sdk/dist/optimizely.browser.umd.min.js"></script>
    <script>
        var optimizelyClient = window.optimizelySdk.createInstance({
            sdkKey: '8i8Jv5NVAEVcGa8JnFJzH'
        });
    </script>
    <!-- Segment snippet -->
    <script>
      !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on","addSourceMiddleware","addIntegrationMiddleware","setAnonymousId","addDestinationMiddleware"];analytics.factory=function(e){return function(){var t=Array.prototype.slice.call(arguments);t.unshift(e);analytics.push(t);return analytics}};for(var e=0;e<analytics.methods.length;e++){var key=analytics.methods[e];analytics[key]=analytics.factory(key)}analytics.load=function(key,e){var t=document.createElement("script");t.type="text/javascript";t.async=!0;t.src="https://cdn.segment.com/analytics.js/v1/" + key + "/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n);analytics._loadOptions=e};analytics._writeKey="GI3L6Yfc6pZcez9Bg9aoulGetftkAb8v";;analytics.SNIPPET_VERSION="4.15.3";
      analytics.load("GI3L6Yfc6pZcez9Bg9aoulGetftkAb8v");
      
      
      //middleware
      var SMW1 = function({ payload, next, integrations }) {
        if (payload.obj.type == 'track' || payload.obj.type == 'page') {
            payload.obj.properties.testProperty = '***test***';
        }
        next(payload);
      };
      
      analytics.addSourceMiddleware(SMW1);
      
      analytics.page();
      }}();
    </script>
</head> 
<body style="background-color:darkseagreen; margin: 10px; text-align:center;"> 
<h1>Form Submission</h1> 
<form name="travel" onsubmit="identify(event)">
     What is your favorite travel destination?
    <input name="destination" required="" size="60" type="text"/> 
    <br><br>
    Number of times you have been there: <input name="frequency" size="30" type="number"/>
    <br><br><br> 
    Any recommendations (cool things to do, places to visit or restaurants to eat)? 
    <br><br> 
    <textarea cols="81" name="details" required="" rows="5">
    </textarea> 
    <br><br> 
    Name: <input name="fullname" required="" size="60" type="text"/> 
    <br><br> 
    Email: <input name="email" required="" size="60" type="email"/> 
    <br><br>
    User ID: <input name="id" required="" size="30" type="text"/> 
    <br><br>
    <input name="submit" type="submit" value="Submit"/>
</form>
<script type="text/javascript">
      function identify(e){
        e.preventDefault();
        var form = e.target;
        var email = form["email"].value;
        var fullname = form["fullname"].value;
        var destination = form["destination"].value;
        var details = form["details"].value;
        var number = form["frequency"].value;
        var id = form["id"].value;
        var user = {
            email: email, 
            name: fullname, 
            destination: destination, 
            details: details,
            visits: number
        };
        analytics.identify(id, {
            email: email,
            name: fullname
        });
        analytics.track('Destination Submitted', user, function() {
            window.location.href = "";
        });
      }
</script>
<br>
<h1>Track Events</h1> 
<form name="events" onsubmit="testButton(event)">
    Event Name:
    <input name="eventname" required="" size="40" type="text"/> 
    <br>
    User ID: 
    <input name="id_two" required="" size="30" type="text"/> 
    <br>
    Email: 
    <input name="email_two" required="" size="60" type="email"/> 
    <br>
    <input name="track" type="submit" value="Track"/>
</form>
<script type="text/javascript">
    function testButton(e){
        e.preventDefault();
        var formtwo = e.target;
        var eventName = formtwo["eventname"].value;
        var emailTwo = formtwo["email_two"].value;
        var idTwo = formtwo["id_two"].value;
        var usertwo = {
            email: emailTwo,
        };
        analytics.identify(idTwo, usertwo);
        analytics.track(eventName, usertwo, function() {
            window.location.href = "";}, {
                integrations: {
                    'Google Analytics': false
                }
            
            
        });
    }
</script>
<h1>Protocols Testing</h1> 
<button type="button" onclick="unplannedButton(event)">Unplanned Event</button>
<script type="text/javascript">
    function unplannedButton(e){
        analytics.track('Unplanned Event');
    }
</script>
 <button type="button" onclick="schemaViolation(event)">JSON Schema Violation</button>
<script type="text/javascript">
    function schemaViolation(e){
        analytics.track('Destination Submitted', {hometown: 'New York'});
    }
</script>
<h1>Group Calls</h1> 
<button type="button" onclick="loc(event)">Location Group</button>
<script type="text/javascript">
    function loc(e){
        analytics.group('123SB', {
            name: 'My Company',
            industry: 'Technology',
            city: 'New York',
            type: 'location_id',
            id: '123SB'
        });
    }
</script>
 <button type="button" onclick="acc(event)">Account Group</button>
<script type="text/javascript">
    function acc(e){
        analytics.group('A694', {
            name: 'My Company',
            industry: 'Technology',
            type: 'account_id',
            id: 'A694'
        });
    }
</script>
<h1>Page Call with Custom Properties</h1> 
<button type="button" onclick="page(event)">Page</button>
<script type="text/javascript">
    function page(e){
       analytics.page('Car Feature Added', {
            vin: '111222333456',
            model: 'tiguan',
            photo_added: '1'
       });  
    }
</script>
</body> 
<h1>Anonymous User Track Event</h1> 
<button type="button" onclick="anon(event)">Anonymous Track</button>
<script type="text/javascript">
    function anon(e){
       analytics.track('Deals Browsed', {
            category: 'clothing'
       });  
    }
</script>
<h1>Grab braze_id For Anonymous User and Identify</h1> 
<button type="button" onclick="braze(event)">Braze ID</button>
<script type="text/javascript">
   // var deviceid = appboy.getDeviceId(function(deviceId)
    /*function braze(e){
        analytics.identify({
           test_flag: true
        },{context: {integrations: {
           'Braze': {
               'braze_id': '5e65a780235c1036c27f2b54'
        }}}});
    }*/
</script>
<script>
    analytics.on('track', function(event, properties, options) {
        console.log("On Track");
    });

    analytics.on('identify', function(event, properties, options) {
        console.log("On Identify");
    });
</script>
<pre>Welcome to our Quickstart Guide!</pre>
<pre id="errors"></pre>
<pre id="experiences"></pre>
<pre id="result"></pre>
<script>
        optimizelyClient.onReady().then(() => {
      var errors = document.getElementById('errors');
      if (!optimizelyClient.isValidInstance()) {
        errors.innerText = 'Optimizely client invalid. Verify in Settings>Environments that you used the primary environment\'s SDK key';

        return;
      }

      var experiences = document.getElementById('experiences');
      let hasOnFlags = false;
      for (let i = 0; i < 10; i++) {
        // to get rapid demo results, generate random users. Each user always sees the same variation unless you reconfigure the flag rule.
        let userId = (Math.floor(Math.random() * (10000 - 1000) + 1000)).toString();

        // Create hardcoded user & bucket user into a flag variation
        let user = optimizelyClient.createUserContext(userId);

        // "product_sort" corresponds to a flag key in your Optimizely project
        let decision = user.decide('product_sort');
        let variationKey = decision.variationKey;

        // did decision fail with a critical error?
        if (variationKey === null) {
          errors.innerText += `\n\ndecision error: ${decision['reasons']}`;
        }

        // get a dynamic configuration variable
        // "sort_method" corresponds to a variable key in your Optimizely project
        let sortMethod = decision.variables['sort_method'];

        if (decision.enabled) {
          hasOnFlags = true;
        }

        // Mock what the users sees with print statements (in production, use flag variables to implement feature configuration)
        // always returns false until you enable a flag rule in your Optimizely project
        experiences.innerText += `\n\nFlag ${decision.enabled ? 'on' : 'off'}. User number ${user.getUserId()} saw flag variation: ${variationKey} and got products sorted by: ${sortMethod} config variable as part of flag rule: ${decision.ruleKey}`;
      }

      var result = document.getElementById('result');
      if (!hasOnFlags) {
        result.innerText = "\n\nFlag was off for everyone. Some reasons could include:" +
          "\n1. Your sample size of visitors was too small. Rerun, or increase the iterations in the FOR loop" +
          "\n2. By default you have 2 keys for 2 project environments (dev/prod). Verify in Settings>Environments that you used the right key for the environment where your flag is toggled to ON." +
          "\n\nCheck your key at https://app.optimizely.com/v2/projects/" + optimizelyClient.projectConfigManager.getConfig().projectId + "/settings/implementation";
      };
    });
</script>
</body> 
</html>
